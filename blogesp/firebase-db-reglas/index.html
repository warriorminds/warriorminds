<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Base de Datos en Tiempo Real con Firebase &#8211; Warrior Minds</title>
<meta name="description" content="Firebase proporciona una base de datos en tiempo real. Este Post habla de las reglas para configurar el acceso a la base de datos.">
<meta name="keywords" content="firebase, android, base de datos">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Base de Datos en Tiempo Real con Firebase">
<meta name="twitter:description" content="Firebase proporciona una base de datos en tiempo real. Este Post habla de las reglas para configurar el acceso a la base de datos.">
<meta name="twitter:site" content="@warrior_minds">
<meta name="twitter:creator" content="@warrior_minds">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://warriorminds.github.io//images/site-logo.png">

<!-- Open Graph -->
<meta property="og:locale" content="es_MX">
<meta property="og:type" content="article">
<meta property="og:title" content="Base de Datos en Tiempo Real con Firebase">
<meta property="og:description" content="Firebase proporciona una base de datos en tiempo real. Este Post habla de las reglas para configurar el acceso a la base de datos.">
<meta property="og:url" content="https://warriorminds.github.io//blogesp/firebase-db-reglas/">
<meta property="og:site_name" content="Warrior Minds">

<!-- Webmaster Tools verfication -->
<meta name="google-site-verification" content="zWZJBibG8K_1P8JoyAvMcsxBjzkx7tOIVm6knil7Ke8">
<meta name="msvalidate.01" content="BDA9831FA00B2435A6575FB4641D8066">


<link rel="canonical" href="https://warriorminds.github.io//blogesp/firebase-db-reglas/">
<link href="https://warriorminds.github.io//feed.xml" type="application/atom+xml" rel="alternate" title="Warrior Minds Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://warriorminds.github.io//assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="https://warriorminds.github.io//assets/js/vendor/html5shiv.min.js"></script>
  <script src="https://warriorminds.github.io//assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="https://warriorminds.github.io//assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://warriorminds.github.io//favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://warriorminds.github.io//favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://warriorminds.github.io//images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://warriorminds.github.io//images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://warriorminds.github.io//images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://warriorminds.github.io//images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="https://warriorminds.github.io//" >Inicio</a></li>
		  
		    
		    <li><a href="https://warriorminds.github.io//blog/es/" >Blog</a></li>
		  
		    
		    <li><a href="https://warriorminds.github.io//categories/" >Categorias</a></li>
		  
		    
		    <li><a href="https://warriorminds.github.io//search/" >Buscar</a></li>
		  
		    
		    <li><a href="https://warriorminds.github.io//about/" >Acerca de</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
  		<a href="https://warriorminds.github.io//" class="site-logo" rel="home" title="Warrior Minds"><img src="https://warriorminds.github.io//images/site-logo.png" width="200" height="200" alt="Warrior Minds logo" class="animated fadeInDown"></a>
      
      <h1 class="site-title animated fadeIn"><a href="https://warriorminds.github.io//">Warrior Minds</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Entrena tu mente en las artes del Software.</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//github.us14.list-manage.com/subscribe/post?u=b7c3d4083b8b3456c5927056f&amp;id=b18df401fa" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Suscríbete a Warrior Minds</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="correo electrónico" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_b7c3d4083b8b3456c5927056f_b18df401fa" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Suscríbete" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup-->

<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="https://warriorminds.github.io//tags/#firebase" title="Pages tagged firebase">firebase</a></li><li><a href="https://warriorminds.github.io//tags/#android" title="Pages tagged android">android</a></li><li><a href="https://warriorminds.github.io//tags/#base de datos" title="Pages tagged base de datos">base de datos</a></li>
        </ul>
        
          <h1 class="entry-title">Base de Datos en Tiempo Real con Firebase</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="https://warriorminds.github.io//images/bio-photo.png" class="bio-photo" alt="Warrior Minds bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Warrior Minds</span></span>
        
        <span class="entry-date date published"><time datetime="2017-01-31T11:25:55-06:00"><i class="fa fa-calendar-o"></i> January 31, 2017</time></span>
        
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        <span class="social-share-twitter">
  <a href="https://twitter.com/intent/tweet?hashtags=firebase,android,basededatos&amp;text=Base%20de%20Datos%20en%20Tiempo%20Real%20con%20Firebase&amp;url=https://warriorminds.github.io//blogesp/firebase-db-reglas/&amp;via=warrior_minds" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square"></i> Tweet</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https://warriorminds.github.io//blogesp/firebase-db-reglas/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square"></i> Like</a>
</span>
<span class="social-share-googleplus">
  <a href="https://plus.google.com/share?url=https://warriorminds.github.io//blogesp/firebase-db-reglas/" title="Share on Google Plus" itemprop="GooglePlus"><i class="fa fa-google-plus-square"></i> +1</a>
</span>
<!-- /.social-share -->
        <div class="google-ads" style="margin-top:40px; text-align:center;">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- 160x600 ad -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:160px;height:600px"
       data-ad-client="ca-pub-8872211495609343"
       data-ad-slot="4963587312"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div><!-- /.google-ads --><!-- /.google-ads -->
      </footer>
      <div class="entry-content">
        <p>Toda la información oficial de Firebase la pueden encontrar <a href="https://console.firebase.google.com/" target="_blank">aquí</a>.</p>

<h2 id="introduccin">Introducción</h2>

<p>Firebase nos proporciona una base de datos en tiempo real, permite trabajar de forma sin conexión y se puede utilizar con Android, iOS y web. Es una base de datos NoSQL y por lo mismo, almacena los datos en un archivo con formato JSON.</p>

<p>Utilizar la base de datos de Firebase nos da la ventaja de que está en la nube, así evitamos todo lo relacionado con el soporte y mantenimiento y además se puede ir expandiendo conforme aumente el uso.</p>

<p>Para tener acceso a la base de datos, debemos entrar en la <a href="https://console.firebase.google.com/">consola de Firebase</a>, en el menú <em>Base de Datos</em>. En esa pantalla tenemos acceso a nuestra base de datos, a la configuración de reglas, estadísticas de uso y copias de seguridad.</p>

<figure>
    <a href="https://warriorminds.github.io//images/fb/db/03.inicio-db.png"><img src="https://warriorminds.github.io//images/fb/db/03.inicio-db.png" alt="Base de datos en la consola." /></a>
</figure>

<p>En este Post nos enfocaremos en entender y aprender cómo crear las <em>reglas</em>, que son la base para la seguridad de nuestra base de datos. En el siguiente Post, crearemos una base de datos e implementaremos el código necesario para utilizar la base desde una aplicación Android.</p>

<h2 id="reglas">Reglas</h2>

<p>Las <em>reglas</em> permiten definir quién tiene acceso de <em>lectura</em>, quien puede tener acceso de <em>escritura</em>, permite definir el <em>formato de los datos</em> (si un elemento puede tener hijos y definir el tipo de dato del elemento) y además permiten definir un elemento de los datos como <em>índice</em> para poder realizar búsquedas. Para configurar Reglas seleccionamos la pestaña <em>Reglas</em> en la consola de Firebase.</p>

<figure>
    <a href="https://warriorminds.github.io//images/fb/db/04.reglas.png"><img src="https://warriorminds.github.io//images/fb/db/04.reglas.png" alt="Reglas en la consola." /></a>
</figure>

<p>La estructura de las reglas debe de seguir la estructura de la base de datos, para que se puedan cumplir de manera adecuada. De igual manera, las reglas fallarán si no se tiene definida una regla en el padre.</p>

<h3 id="reglas-de-escritura-y-lectura">Reglas de Escritura y Lectura</h3>

<p>Existen dos tipos de reglas para regular el acceso a lectura y escritura de datos en nuestra base. Estas dos reglas son</p>
<ul>
  <li><em>.read</em>: define las reglas que permiten la lectura de datos.</li>
  <li><em>.write</em>: define las reglas que permiten la escritura de datos.</li>
</ul>

<p>Por default, está permitido hacer escritura y lectura de datos a los usuarios que están autenticados. Tenemos disponible la variable <em>auth</em> que es diferente de <em>null</em> cuando el usuario está autenticado. Al entrar a la sección de <em>Base de Datos -&gt; Reglas</em> por primera vez, tenemos las siguientes reglas:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">".read"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth != null"</span><span class="p">,</span><span class="w">
  </span><span class="nt">".write"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth != null"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Las reglas tienen un formato tipo <em>JSON</em> empezando siempre con el nodo <em>rules</em> y donde cada elemento hijo de <em>rules</em> es una ruta diferente. Por ejemplo, nuestra base de datos tendrá una URL de la siguiente manera:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="err">https://firebase-basededatos.firebaseio.com</span><span class="w">
</span></code></pre>
</div>

<p>Si queremos agregar un elemento <em>/mensajes</em> a nuestra base de datos y ponerle reglas, lo haríamos de la siguiente manera:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"mensajes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">".read"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth != null"</span><span class="p">,</span><span class="w">
          </span><span class="nt">".write"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth != null"</span><span class="w">
        </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Esta regla define que para la ruta <em>https://firebase-basededatos.firebaseio.com/mensajes</em> todos los usuarios autenticados pueden leer y escribir datos.</p>

<p>Las reglas que definimos se aplican a <strong>todos los hijos</strong>; esto quiere decir que los hijos van a seguir las reglas que tenga el primer ancestro, sobreescribiendo las reglas definidas en los hijos.</p>

<p>Por ejemplo, en la siguiente regla, está definida una regla en el padre que permite escribir a cualquier usuario, sin necesitar autenticación. También tenemos definida en el hijo <em>/mensajes</em> otra regla que solamente permite a los usuarios autenticados escribir datos.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">".read"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth == null"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"mensajes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">".read"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth != null"</span><span class="p">,</span><span class="w">
          </span><span class="nt">".write"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth != null"</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Como en Firebase se aplica la regla del primer ancestro, entonces cualquier usuario podría escribir datos en <em>/mensajes.</em></p>

<p>Firebase también nos proporciona algunas <em>variables</em> que podemos utilizar, por ejemplo podemos hacer referencia a otras rutas de nuestra base de datos, tener acceso a identificadores de autenticación de usuarios, entre otras.</p>

<p>Un escenario común que podríamos encontrar, es solamente permitir que el usuario modifique su propia información. Para esto, podemos crear la variable <em>$uid</em>. Cada usuario podría tener asignada una URL, utilizando su identificador de usuario (obtenido al iniciar sesión con Firebase). Por ejemplo,</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="err">https://firebase-basededatos.firebaseio.com/usuarios/</span><span class="mi">123</span><span class="err">ab</span><span class="mi">45-123</span><span class="err">a</span><span class="mi">-1234</span><span class="err">-abcde-a</span><span class="mi">1</span><span class="err">abc</span><span class="mi">123</span><span class="err">a</span><span class="mi">1</span><span class="err">a</span><span class="mi">1</span><span class="w">
</span></code></pre>
</div>

<p>Donde <em>123ab45-123a-1234-abcde-a1abc123a1a1</em> es el identificador del usuario. Si solamente queremos que ese usuario pueda leer datos de esa URL, definiríamos la siguiente regla:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"usuarios"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"$uid"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">".read"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$uid === auth.uid"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Esta regla se leería de la siguiente manera: para la ruta <em>/usuarios/$uid</em> solamente podrán leer los datos de cada <em>$uid</em> los usuarios que se hayan autenticado y que tengan la misma <em>uid</em> después de autenticarse.</p>

<p>Más adelante veremos más variables que tenemos disponibles para definir las reglas.</p>

<h2 id="reglas-de-validacin">Reglas de Validación</h2>

<p>Podemos utilizar las reglas para <em>validar</em> los datos que se van a escribir a nuestra base. Es necesario tener estas reglas ya que la base de datos de Firebase <em>no tiene esquema</em> (al ser NoSQL). Con estas reglas podemos validar que los datos ingresados sean correctos y no pueda haber problemas posteriormente. Las reglas de validación se ejecutan <em>una vez que se autorizó la escritura de los datos</em> (se cumplieron las reglas de .write).</p>

<p>Para crear una regla de validación, debemos utilizar la palabra <em>.validate</em>. Como introducción, crearemos una regla que indique que unos valores serán números, cadenas, y limitaremos el tamaño de unas cadenas.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">".read"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth != null"</span><span class="p">,</span><span class="w">
      </span><span class="nt">".write"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cadenas"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">".validate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newData.isString()"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"numeros"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">".validate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newData.isNumber()"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"cadenaTamaño"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">".validate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newData.isString() &amp;&amp; newData.val().length &gt; 5"</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Utilizando el simulador, podemos hacer pruebas y ver cuándo nuestras reglas se cumplen y cuando no.</p>

<figure>
    <a href="https://warriorminds.github.io//images/fb/db/00.regla1.png"><img src="https://warriorminds.github.io//images/fb/db/00.regla1.png" alt="Reglas en el simulador." /></a>
</figure>

<figure>
    <a href="https://warriorminds.github.io//images/fb/db/01.regla2.png"><img src="https://warriorminds.github.io//images/fb/db/01.regla2.png" alt="Reglas en el simulador." /></a>
</figure>

<figure>
    <a href="https://warriorminds.github.io//images/fb/db/02.regla3.png"><img src="https://warriorminds.github.io//images/fb/db/02.regla3.png" alt="Reglas en el simulador." /></a>
</figure>

<p>Más adelante veremos reglas más avanzadas.</p>

<h2 id="reglas-para-indexacin">Reglas para indexación</h2>

<p>La base de datos en Firebase nos permite hacer búsquedas de los datos. Es importante crear <em>índices</em> para que estas búsquedas sean más eficientes, ya que la base puede contener una gran cantidad de datos.</p>

<p>Se utilizan las reglas para crear índices, con la palabra <em>indexOn</em>, proporcionando el nombre de los campos que queremos utilizar como índices:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"usuarios"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">".indexOn"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"apodo"</span><span class="p">,</span><span class="w"> </span><span class="s2">"nombre"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Con esta regla indexamos la ruta <em>usuarios</em> con sus nodos hijos apodo y nombre. Esta manera de indexar es indexar utilizando los nodos hijos.</p>

<p>Tambiéne podemos indexar utilizando los valores, en lugar de los hijos. Para esto utilizamos el valor <em>.value</em></p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"indexOn"</span><span class="err">:</span><span class="w"> </span><span class="s2">".value"</span><span class="w">
</span></code></pre>
</div>

<h2 id="variables-disponibles-para-crear-reglas">Variables Disponibles para crear Reglas</h2>

<p>Existen algunas variables predefinidas que podemos utilizar para crear nuestras reglas. Pueden ver la lista completa <a href="https://firebase.google.com/docs/reference/security/database/#variables" target="_blank">aquí</a>.</p>

<h3 id="auth">auth</h3>

<p>Como ya hemos visto, esta variable nos indica si el usuario ha sido autenticado y contiene la siguiente información:</p>

<ul>
  <li><em>provider</em>: Nos indica qué método utilizó el usuario para iniciar sesión.</li>
  <li><em>uid</em>: El identificador único del usuario.</li>
  <li><em>token</em>: el token de autenticación del usuario.</li>
</ul>

<p>Por ejemplo, si queremos que solamente puedan leer los datos usuarios que iniciaron sesión con Google, podemos definir una regla como la siguiente:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">".read"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth.provider == 'google'"</span><span class="p">,</span><span class="w">
    </span><span class="nt">".write"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth != null"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="authtoken">auth.token</h3>

<p>Esta variable contiene la información del inicio de sesión del usuario. Puede o no tener las siguientes variables:</p>

<ul>
  <li><em>email</em>: el correo electrónico utilizado.</li>
  <li><em>email_verified</em>: si el correo electrónico está verificado.</li>
  <li><em>name</em>: el nombre del usuario</li>
  <li><em>firebase.sing_in_provider</em>: el proveedor del inicio de sesión.</li>
</ul>

<h3 id="variable">$variable</h3>

<p>Como vimos anteriormente, se pueden definir variables en nuestra estructura de reglas con el símbolo $. Por ejemplo, habíamos definido la variable $uid para representar la ruta  https://firebase-basededatos.firebaseio.com/usuarios/$uid donde $uid podría tener un valor similar a 123ab45-123a-1234-abcde-a1abc123a1a1.</p>

<p>Una vez definidas estas variables, podemos utilizarlas dentro de las reglas.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"$uid"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">".read"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$uid === auth.uid"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Esta regla se podría traducir de la siguiente manera:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"123ab45-123a-1234-abcde-a1abc123a1a1"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">".read"</span><span class="p">:</span><span class="w"> </span><span class="s2">" 123ab45-123a-1234-abcde-a1abc123a1a1 === auth.uid"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Teniendo un valor diferente dependiendo del usuario que inicie sesión. De igual manera, podemos crear las variables que sean necesarias.</p>

<h3 id="now">now</h3>

<p>Esta variable contiene la cantidad de milisegundos transcurridos desde la fecha Epoch Unix (medianoche del 1 de enero de 1970 UTC) hasta el memento de la utilización. Podemos utilizar esta variable para crear reglas referentes al tiempo y fecha.</p>

<h3 id="root">root</h3>

<p>La variable root contiene una <em>copia de los datos de la base como se encuentra antes de realizar la operación</em>. Se utiliza para leer datos que existen previamente en la base y crear reglas basadas en esos datos.</p>

<h3 id="data">data</h3>

<p>Esta variable es similar a root, con la diferencia que solamente trae la <em>copia de los datos en la ubicación que se está modificando</em>. Por ejemplo,</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"libros"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"$usuario"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">".read"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data.child('nombre').val() == 'John'"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>En este ejemplo, <em>data</em> contiene los datos que existen en $usuario. Por eso podemos tener acceso a su hijo (child) nombre y obtener su valor.</p>

<h3 id="newdata">newData</h3>

<p>De igual manera, newData es similar a las dos variables anteriores. En este caso, newData trae la <em>información de los datos que se van a agregar</em>. Esta variable solamente está disponible para las reglas .validate y .write.</p>

<h2 id="mtodos-importantes">Métodos importantes</h2>

<p>Con las variables root, data y newData tenemos algunos métodos que nos permiten obtener información de la base de datos para crear nuestras reglas. Pueden consultar la lista completa <a href="https://firebase.google.com/docs/reference/security/database/#ruledatasnapshot_methods" target="_blank">aquí</a>.</p>

<h3 id="val">val()</h3>

<p>Este método nos permite obtener el valor de un hijo. Los valores que se pueden obtener son String, Number, Boolean y Null.</p>

<h3 id="child">child()</h3>

<p>Este método nos permite tener acceso a un hijo determinado. Por ejemplo, data.child(‘nombre’) utilizado previamente nos da acceso al hijo “nombre” del elemento “$usuario”.</p>

<h3 id="parent">parent()</h3>

<p>Con este método podemos movernos a algún nodo hermano.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="err">data.parent().child('hijo')</span><span class="w">
</span></code></pre>
</div>

<h3 id="haschild-haschildren">hasChild(), hasChildren()</h3>

<p>Estos dos métodos nos sirven para saber si root, data o newData tienen un hijo en específico o si tienen varios hijos. Nos puede servir para validar que newData tenga una estructura predefinida.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="err">newData.hasChildren(</span><span class="p">[</span><span class="err">'hijo</span><span class="mi">1</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">'hijo</span><span class="mi">2</span><span class="err">'</span><span class="p">]</span><span class="err">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="exists">exists()</h3>

<p>Nos indica si root, data, newData contienen algún dato o no.</p>

<h3 id="isnumber-isstring-isboolean">isNumber(), isString(), isBoolean()</h3>
<p>Nos indica si un valor es número, cadena o booleano.</p>

<h2 id="conclusin">Conclusión</h2>

<p>Firebase nos proporciona la base de datos en tiempo real. Necesitamos definir reglas que nos indiquen quiénes tienen permisos para obtener los datos y quiénes tienen permisos para escribir en la base. También podemos tener índices para facilitar la búsqueda, que de igual manera se definen mediante las reglas. Por último, contamos con reglas para validar que los datos que se escriban en la base cumplan con ciertos valores.</p>

<p>En el próximo Post, crearemos una base de datos, implementaremos sus reglas, y utilizaremos una app de Android para escribir y leer en la base.</p>


        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'warriormindswebsite'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="https://warriorminds.github.io//blogesp/firebase-config-remota/" class="btn" title="Configuración Remota con Firebase">Anterior</a>
      
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    <div class="google-ads" style="margin:10px 0;">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- 320x50 ad -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:320px;height:50px"
       data-ad-client="ca-pub-8872211495609343"
       data-ad-slot="9595923317"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div><!-- /.google-ads -->

<span>&copy; 2017 Warrior Minds. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/warrior_minds" title="Warrior Minds on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://facebook.com/warriorminds" title="Warrior Minds on Facebook" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a>
	<a href="https://plus.google.com/102230749926196780961" title="Warrior Minds on Google+" target="_blank"><i class="fa fa-google-plus-square fa-2x"></i></a>
	
	
	
	
	<a href="https://github.com/warriorminds" title="Warrior Minds on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="https://warriorminds.github.io//feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'https://warriorminds.github.io/';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://warriorminds.github.io//assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://warriorminds.github.io//assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 'https://www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-86871758-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



</body>
</html>
