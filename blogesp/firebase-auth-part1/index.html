<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Autenticación con Firebase - Primera Parte: correo, Google y Facebook &#8211; Warrior Minds</title>
<meta name="description" content="Autenticación con Firebase utilizando correo electrónico, cuenta de Google y cuenta de Facebook.">
<meta name="keywords" content="firebase, android, autenticación">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Autenticación con Firebase - Primera Parte: correo, Google y Facebook">
<meta name="twitter:description" content="Autenticación con Firebase utilizando correo electrónico, cuenta de Google y cuenta de Facebook.">
<meta name="twitter:site" content="@warrior_minds">
<meta name="twitter:creator" content="@warrior_minds">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://warriorminds.github.io//images/site-logo.png">

<!-- Open Graph -->
<meta property="og:locale" content="es_MX">
<meta property="og:type" content="article">
<meta property="og:title" content="Autenticación con Firebase - Primera Parte: correo, Google y Facebook">
<meta property="og:description" content="Autenticación con Firebase utilizando correo electrónico, cuenta de Google y cuenta de Facebook.">
<meta property="og:url" content="https://warriorminds.github.io//blogesp/firebase-auth-part1/">
<meta property="og:site_name" content="Warrior Minds">

<!-- Webmaster Tools verfication -->
<meta name="google-site-verification" content="zWZJBibG8K_1P8JoyAvMcsxBjzkx7tOIVm6knil7Ke8">
<meta name="msvalidate.01" content="BDA9831FA00B2435A6575FB4641D8066">


<link rel="canonical" href="https://warriorminds.github.io//blogesp/firebase-auth-part1/">
<link href="https://warriorminds.github.io//feed.xml" type="application/atom+xml" rel="alternate" title="Warrior Minds Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://warriorminds.github.io//assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="https://warriorminds.github.io//assets/js/vendor/html5shiv.min.js"></script>
  <script src="https://warriorminds.github.io//assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="https://warriorminds.github.io//assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://warriorminds.github.io//favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://warriorminds.github.io//favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://warriorminds.github.io//images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://warriorminds.github.io//images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://warriorminds.github.io//images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://warriorminds.github.io//images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="https://warriorminds.github.io//" >Inicio</a></li>
		  
		    
		    <li><a href="https://warriorminds.github.io//blog/es/" >Blog</a></li>
		  
		    
		    <li><a href="https://warriorminds.github.io//categories/" >Categorias</a></li>
		  
		    
		    <li><a href="https://warriorminds.github.io//search/" >Buscar</a></li>
		  
		    
		    <li><a href="https://warriorminds.github.io//about/" >Acerca de</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
  		<a href="https://warriorminds.github.io//" class="site-logo" rel="home" title="Warrior Minds"><img src="https://warriorminds.github.io//images/site-logo.png" width="200" height="200" alt="Warrior Minds logo" class="animated fadeInDown"></a>
      
      <h1 class="site-title animated fadeIn"><a href="https://warriorminds.github.io//">Warrior Minds</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Entrena tu mente en las artes del Software.</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//github.us14.list-manage.com/subscribe/post?u=b7c3d4083b8b3456c5927056f&amp;id=b18df401fa" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Suscríbete a Warrior Minds</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="correo electrónico" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_b7c3d4083b8b3456c5927056f_b18df401fa" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Suscríbete" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup-->

<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="https://warriorminds.github.io//tags/#firebase" title="Pages tagged firebase">firebase</a></li><li><a href="https://warriorminds.github.io//tags/#android" title="Pages tagged android">android</a></li><li><a href="https://warriorminds.github.io//tags/#autenticación" title="Pages tagged autenticación">autenticación</a></li>
        </ul>
        
          <h1 class="entry-title">Autenticación con Firebase - Primera Parte: correo, Google y Facebook</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="https://warriorminds.github.io//images/bio-photo.png" class="bio-photo" alt="Warrior Minds bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Warrior Minds</span></span>
        
        <span class="entry-date date published"><time datetime="2016-12-26T14:25:55-06:00"><i class="fa fa-calendar-o"></i> December 26, 2016</time></span>
        
        <span class="entry-date date modified"><time datetime="2017-01-02 14:24:00 -0600"><i class="fa fa-pencil"></i> January 02, 2017</time></span>
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        <span class="social-share-twitter">
  <a href="https://twitter.com/intent/tweet?hashtags=firebase,android,autenticación&amp;text=Autenticación%20con%20Firebase%20-%20Primera%20Parte:%20correo,%20Google%20y%20Facebook&amp;url=https://warriorminds.github.io//blogesp/firebase-auth-part1/&amp;via=warrior_minds" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square"></i> Tweet</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https://warriorminds.github.io//blogesp/firebase-auth-part1/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square"></i> Like</a>
</span>
<span class="social-share-googleplus">
  <a href="https://plus.google.com/share?url=https://warriorminds.github.io//blogesp/firebase-auth-part1/" title="Share on Google Plus" itemprop="GooglePlus"><i class="fa fa-google-plus-square"></i> +1</a>
</span>
<!-- /.social-share -->
        <div class="google-ads" style="margin-top:40px; text-align:center;">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- 160x600 ad -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:160px;height:600px"
       data-ad-client="ca-pub-8872211495609343"
       data-ad-slot="4963587312"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div><!-- /.google-ads --><!-- /.google-ads -->
      </footer>
      <div class="entry-content">
        <p>Toda la información oficial de Firebase la pueden encontrar <a href="https://console.firebase.google.com/" target="_blank">aquí</a>.</p>

<p>El código completo para este Post lo pueden encontrar en <a href="https://github.com/warriorminds/firebase-autenticacion" target="_blank">Github</a></p>

<p>Este Post crea una actividad independiente para cada tipo de autenticación. El código de esa aplicación lo pueden encontrar en la rama master del repositorio en Github.</p>

<p>También podrán encontrar una app que utiliza todos los tipos de autenticación en una misma actividad. Este código lo pueden encontrar en la rama <a href="https://github.com/warriorminds/firebase-autenticacion/tree/app_completa" target="_blank">app_completa</a>.</p>

<p>Pueden encontrar la segunda parte de este Post <a href="https://warriorminds.github.io//blogesp/firebase-auth-part2">aquí</a>. En la segunda parte encontrarán cómo iniciar sesión con Twitter y con usuarios anónimos.</p>

<h2 id="introduccin">Introducción</h2>

<p>Firebase nos proporciona las herramientas necesarias para <em>autenticar</em> a nuestros usuarios. Ofrece soluciones para autenticar utilizando correo electrónico y contraseña, Google, Facebook, Twitter, Github, tu sistema personalizado de autenticación y además permite autenticar usuarios de manera anónima.</p>

<p>En este Post, el cual será la primera parte para utilizar autenticación con Firebase, veremos cómo implementar la creación de cuentas con correo y contraseña, iniciar sesión con correo y contraseña, con cuentas de Google y de Facebook.</p>

<p>Vamos a tomar el código como lo dejamos en el <a href="https://warriorminds.github.io//blogesp/firebase-intro" target="_blank">post anterior</a>.</p>

<p>Para agregar autenticación a tu app, debemos de agregar esta dependencia al archivo <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/app/build.gradle" target="_blank">build.gradle</a>.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">compile</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">firebase</span><span class="o">:</span><span class="n">firebase</span><span class="o">-</span><span class="nl">auth:</span><span class="mf">9.8</span><span class="o">.</span><span class="mi">0</span><span class="err">'</span>
</code></pre>
</div>

<h2 id="crear-cuenta-con-correo-electrnico-y-contrasea">Crear cuenta con correo electrónico y contraseña</h2>

<p>Todo el código para crear una cuenta con correo y contraseña lo pueden encontrar en la clase <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/app/src/main/java/com/warriorminds/firebase/CrearCuentaActivity.java" target="_blank">CrearCuentaActivity.java</a>. Recuerden que necesitan agregar su archivo de <em>google-services.json</em> al proyecto, en la carpeta app, para que funcione la aplicación.</p>

<p>Firebase nos proporciona dos objetos que son los que nos permiten crear cuentas e iniciar sesión. Si bien iniciar sesión con cada proveedor (Google, Facebook) tiene sus detalles, en general estos dos objetos son los que necesitamos utilizar.</p>

<ul>
  <li>FirebaseAuth</li>
  <li>FirebaseAuth.AuthStateListener</li>
</ul>

<p>Necesitamos obtener la instancia de FirebaseAuth y crear el listener que escuchará los cambios de estado en la cuenta.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">inicializarAutenticacion</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">autenticacionFirebase</span> <span class="o">=</span> <span class="n">FirebaseAuth</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>

    <span class="n">listenerAutenticacion</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FirebaseAuth</span><span class="o">.</span><span class="na">AuthStateListener</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAuthStateChanged</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">FirebaseAuth</span> <span class="n">firebaseAuth</span><span class="o">)</span> <span class="o">{</span>

            <span class="n">FirebaseUser</span> <span class="n">usuario</span> <span class="o">=</span> <span class="n">firebaseAuth</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">();</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">usuario</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// El usuario ha iniciado sesión</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// El usuario no ha iniciado sesion aun</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>
</code></pre>
</div>

<p>El método de <em>onAuthStateChanged()</em> se manda llamar cuando hay un cambio en el estado de la sesión; por ejemplo cuando el usuario inició o cerró sesión. También cuando se termina de inicializar Firebase, por lo que al entrar a la actividad se ejecutará este método también.  En este método podemos utilizar el objeto FirebaseAuth para obtener el FirebaseUser. Si obtenemos un valor de usuario, significa que ha iniciado sesión. Esta inicialización se debe de realizar en el onCreate().</p>

<p>Una vez creado el listener, necesitamos agregarlo a nuestro objeto FirebaseAuth. Esto se lleva a cabo en el onStart() de nuestra actividad. Así mismo, se debe de quitar el listener del objeto FirebaseAuth en el onStop().</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
    <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">addAuthStateListener</span><span class="o">(</span><span class="n">listenerAutenticacion</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">listenerAutenticacion</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">removeAuthStateListener</span><span class="o">(</span><span class="n">listenerAutenticacion</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Por último, vamos a añadir las instrucciones para crear la cuenta. En nuestro proyecto hay un botón al cual se le asigna un onClickListener() que manda llamar el método crearCuenta(String email, String password). En este método, lo que tenemos que hacer es llamar el método <em>createUserWithEmailAndPassword()</em> del objeto autenticaciónFirebase. De igual manera se le agrega un listener, <em>addOnCompleteListener()</em> el cual se llamará cuando se termine de crear el usuario y nos indicará si hubo algún error o si la operación fue exitosa.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">crearCuenta</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">createUserWithEmailAndPassword</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">password</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addOnCompleteListener</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="n">OnCompleteListener</span><span class="o">&lt;</span><span class="n">AuthResult</span><span class="o">&gt;()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onComplete</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">Task</span><span class="o">&lt;</span><span class="n">AuthResult</span><span class="o">&gt;</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>

                    <span class="k">if</span> <span class="o">(!</span><span class="n">task</span><span class="o">.</span><span class="na">isSuccessful</span><span class="o">())</span> <span class="o">{</span>
                        <span class="c1">// Hubo algún error.</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="c1">// La operación de creación de cuenta fue exitosa.</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">});</span>
<span class="o">}</span>
</code></pre>
</div>

<p>El código de ejemplo también les proporciona el layout con los campos de texto para correo y contraseña, un círculo para mostrar el progreso mientras se hace la creación de cuenta, así como una validación simple del correo y la contraseña. De igual manera, hay código para mostrar correos electrónicos que se encuentren asociados al teléfono. Cabe destacar que Firebase permite contraseñas de al menos <em>seis caracteres</em>, si no, regresa un error.</p>

<h3 id="activacin-en-la-consola">Activación en la Consola</h3>

<p>Para que nuestro código funcione, necesitamos ir a la <a href="https://console.firebase.google.com/" target="_blank">consola de Firebase</a>. Una vez ahí, en el menú del lado izquierdo hay que seleccionar la opción de Autenticación. Esta pantalla nos presenta tres pestañas. Necesitamos abrir la pestaña <em>Método de Inicio de Sesión</em>, que se muestra en la siguiente imagen.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/8.consola-metodo-inicio-sesion.png"><img src="https://warriorminds.github.io//images/fb/auth/8.consola-metodo-inicio-sesion.png" alt="Método de Inicio de Sesión" /></a>
</figure>

<p>Una vez en esta pantalla, daremos clic en la opción de <em>Correo electrónico/contraseña</em>. Se abrirá un diálogo donde podemos activar esta opción y guardar los cambios.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/9.habilitar-email-pwd.png"><img src="https://warriorminds.github.io//images/fb/auth/9.habilitar-email-pwd.png" alt="Activar correo electrónico y contraseña" /></a>
</figure>

<p>Ahora podemos iniciar nuestra app y crear una cuenta con correo electrónico y contraseña.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/10.app-crear-cuenta-mail.png"><img src="https://warriorminds.github.io//images/fb/auth/10.app-crear-cuenta-mail.png" alt="Actividad para crear cuenta con correo y contraseña." /></a>
</figure>

<p>Podemos ver que creamos la cuenta y además iniciamos sesión. Ahora tenemos acceso al objeto <em>FirebaseUser</em>. Pueden revisar el método asignarUsuario(FirebaseUser usuarioFirebase).</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/11.cuenta-creada-email.png"><img src="https://warriorminds.github.io//images/fb/auth/11.cuenta-creada-email.png" alt="Al crear cuenta se inicia sesión." /></a>
</figure>

<h2 id="inicio-de-sesin-con-correo-electrnico-y-contrasea">Inicio de Sesión con Correo Electrónico y Contraseña</h2>

<p>El código para iniciar sesión con correo electrónico y contraseña lo pueden encontrar en <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/app/src/main/java/com/warriorminds/firebase/IniciarSesionCorreoContrasenaActivity.java" target="_blank">IniciarSesionCorreoContraseñaActivity.java</a>.</p>

<p>Para iniciar sesión, se deben de seguir pasos muy similares al punto anterior, cuando creamos la cuenta. Primero se debe de inicializar el listener FirebaseAuth.AuthStateListener y posteriormente se debe de agregar el listener al objeto FirebaseAuth en el onStart() y quitarlo en el onStop().</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">inicializarAutenticacion</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">autenticacionFirebase</span> <span class="o">=</span> <span class="n">FirebaseAuth</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>

    <span class="n">listenerAutenticacion</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FirebaseAuth</span><span class="o">.</span><span class="na">AuthStateListener</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAuthStateChanged</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">FirebaseAuth</span> <span class="n">firebaseAuth</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">FirebaseUser</span> <span class="n">usuario</span> <span class="o">=</span> <span class="n">firebaseAuth</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">();</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">usuario</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// El usuario ya inició sesión.</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// El usuario no ha iniciado sesión aún.</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
    <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">addAuthStateListener</span><span class="o">(</span><span class="n">listenerAutenticacion</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">listenerAutenticacion</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">removeAuthStateListener</span><span class="o">(</span><span class="n">listenerAutenticacion</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Por último se debe de llamar el método <em>signInWithEmailAndPassword()</em> del objeto FirebaseAuth para inciar sesión. Se le agrega un listener con <em>addOnCompleteListener()</em> para escuchar los cambios y ver si se pudo iniciar sesión o no. De igual manera, al terminar la operación de iniciar sesión, se ejecutará el método <em>onAuthStateChanged()</em> del listener FirebaseAuth.AuthStateListener en donde podremos obtener el usuario.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">iniciarSesion</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">signInWithEmailAndPassword</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">password</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addOnCompleteListener</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="n">OnCompleteListener</span><span class="o">&lt;</span><span class="n">AuthResult</span><span class="o">&gt;()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onComplete</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">Task</span><span class="o">&lt;</span><span class="n">AuthResult</span><span class="o">&gt;</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">mostrarProgreso</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

                    <span class="k">if</span> <span class="o">(!</span><span class="n">task</span><span class="o">.</span><span class="na">isSuccessful</span><span class="o">())</span> <span class="o">{</span>
                        <span class="c1">// Hubo algún error</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="c1">// Se inició sesión. Se llamará el listener.</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">});</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Se incluye además de esto, el mismo código que en la clase <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/app/src/main/java/com/warriorminds/firebase/CrearCuentaActivity.java" target="_blank">CrearCuentaActivity.java</a>., para validar los datos, mostrar el círculo de progreso, mostrar las cuentas asociadas al teléfono.</p>

<p>Podemos iniciar sesión con la cuenta de correo que utilizamos anteriormente.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/13.login-email.png"><img src="https://warriorminds.github.io//images/fb/auth/13.login-email.png" alt="Iniciar sesión con correo y contraseña." /></a>
</figure>

<p>Una vez iniciada la sesión podemos tener acceso al FirebaseUser. Pueden ver como en el método <em>asignarUsuario(FirebaseUser usuarioFirebase)</em> obtenemos el correo del usuario utilizado para iniciar sesión.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/12.login-complete.png"><img src="https://warriorminds.github.io//images/fb/auth/12.login-complete.png" alt="Iniciar sesión con correo y contraseña." /></a>
</figure>

<h3 id="cerrar-sesin">Cerrar Sesión</h3>

<p>Para cerrar sesión, se tiene que llamar el método <em>signOut()</em> del objeto FirebaseAuth. Pueden revisar el método <em>cerrarSesion()</em>.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">signOut</span><span class="o">();</span>
</code></pre>
</div>

<h2 id="inicio-de-sesin-con-google">Inicio de sesión con Google</h2>

<p>Utilizar Google Sign-in para iniciar sesión involucra algunos pasos más. Para empezar, hay que activar el inicio de sesión con Google en la consola de Firebase.</p>

<h3 id="activar-inicio-de-sesin-con-google-en-la-consola">Activar Inicio de Sesión con Google en la Consola</h3>

<p>En el menú de la izquierda hay que ir a Autenticación y seleccionar la pestaña de Métodos de Inicio de Sesión. Una vez ahí, seleccionamos la opción de Google para habilitarla. Se muestra una advertencia de necesitar la huella digital SHA1 para poder hacer esto. Esto lo hicimos en el post anterior por lo que no debe de haber problema.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/14.activar-login-google.png"><img src="https://warriorminds.github.io//images/fb/auth/14.activar-login-google.png" alt="Activar inicio de sesión con cuenta de Google." /></a>
</figure>

<p>Antes de guardar los cambios, necesitamos obtener un valor <em>ID de cliente web</em> que se encuentra en esta pantalla. Debemos expandir la opción de <em>Configuración del SDK web (opcional)</em>. Ahí encontraremos el <em>ID de cliente web</em>. Copien y guarden este valor que lo necesitaremos más adelante. Después de guardar este valor podemos guardar los cambios.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/15.token-id-google.png"><img src="https://warriorminds.github.io//images/fb/auth/15.token-id-google.png" alt="ID de cliente web." /></a>
</figure>

<h3 id="dependencias">Dependencias</h3>

<p>Hay que agregar la dependencia de <em>google-play-services-auth</em> en nuestro archivo <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/app/build.gradle" target="_blank">build.gradle</a>.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">compile</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">gms</span><span class="o">:</span><span class="n">play</span><span class="o">-</span><span class="n">services</span><span class="o">-</span><span class="nl">auth:</span><span class="mf">9.8</span><span class="o">.</span><span class="mi">0</span><span class="err">'</span>
</code></pre>
</div>

<p>En esta dependencia viven los objetos de <em>Google Sign In</em> que utilizaremos más adelante.</p>

<h3 id="layout">Layout</h3>

<p>Lo primero que necesitamos hacer, es crear nuestro layout. En él, vamos a agregar un botón <em>SignInButton</em>. En nuestro ejemplo, el layout que utilizamos es <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/app/src/main/res/layout/activity_iniciar_sesion_google.xml" target="_blank">activity_iniciar_sesion_google.xml</a></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">gms</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">SignInButton</span>
    <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">"@+id/boton_sesion_google"</span>
    <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">"match_parent"</span>
    <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">"wrap_content"</span> <span class="o">/&gt;</span>
</code></pre>
</div>

<h3 id="inicializar-firebase">Inicializar Firebase</h3>

<p>El código para iniciar sesión con Google lo pueden encontrar en <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/app/src/main/java/com/warriorminds/firebase/IniciarSesionGoogleActivity.java" target="_blank">IniciarSesionGoogleActivity.java</a>.</p>

<p>Al igual que en las secciones anteriores, debemos inicializar el objeto FirebaseAuth y el FirebaseAuth.AuthStateListener. También hay que agregar el listener al objeto FirebaseAuth en el onStart() y quitarlo en el onStop().</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">inicializarAutenticacion</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">autenticacionFirebase</span> <span class="o">=</span> <span class="n">FirebaseAuth</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>

    <span class="n">listenerAutenticacion</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FirebaseAuth</span><span class="o">.</span><span class="na">AuthStateListener</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAuthStateChanged</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">FirebaseAuth</span> <span class="n">firebaseAuth</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">FirebaseUser</span> <span class="n">usuario</span> <span class="o">=</span> <span class="n">firebaseAuth</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">usuario</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Usuario ha iniciado sesión.</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// Usuario no ha iniciado sesión aún.</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
    <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">addAuthStateListener</span><span class="o">(</span><span class="n">listenerAutenticacion</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">listenerAutenticacion</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">removeAuthStateListener</span><span class="o">(</span><span class="n">listenerAutenticacion</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="inicializar-google-sign-in">Inicializar Google Sign-in</h3>

<p>Debemos de inicializar también los objetos de Google que utilizaremos. Necesitamos dos objetos:</p>

<ul>
  <li>GoogleSignInOptions</li>
  <li>GoogleApiClient</li>
</ul>

<p><em>GoogleSignInOptions</em> nos permite configurar la manera con que iniciaremos sesión. Por ahora utilizaremos las opciones por default de inicio de sesión <em>(DEFAULT_SIGN_IN)</em>. También nos permite agregar opciones que pediremos al usuario, en este caso pediremos acceso a su cuenta de correo electrónico. De igual manera, el <em>ID de cliente web</em> que guardamos al inicio de esta sección, lo debemos proporcionar. Reemplazen este código <em>getString(R.string.default_web_client_id)</em> con el valor del <em>ID de cliente web</em> suyo.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">GoogleSignInOptions</span> <span class="n">opcionesInicioSesionGoogle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GoogleSignInOptions</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">GoogleSignInOptions</span><span class="o">.</span><span class="na">DEFAULT_SIGN_IN</span><span class="o">)</span>
        <span class="o">.</span><span class="na">requestIdToken</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">default_web_client_id</span><span class="o">))</span>
        <span class="o">.</span><span class="na">requestEmail</span><span class="o">()</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre>
</div>

<p><em>GoogleApiClient</em> nos permite iniciar la actividad para iniciar sesión con Google. A este objeto le indicamos que utilizaremos la API de Google Sign In, además de agregarle los listeners necesarios y el objeto <em>GoogleSignInOptions</em> configurado previamente.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">clienteApiGoogle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GoogleApiClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
        <span class="o">.</span><span class="na">enableAutoManage</span><span class="o">(</span><span class="k">this</span> <span class="cm">/* FragmentActivity */</span><span class="o">,</span> <span class="k">this</span> <span class="cm">/* OnConnectionFailedListener */</span><span class="o">)</span>
        <span class="o">.</span><span class="na">addApi</span><span class="o">(</span><span class="n">Auth</span><span class="o">.</span><span class="na">GOOGLE_SIGN_IN_API</span><span class="o">,</span> <span class="n">opcionesInicioSesionGoogle</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre>
</div>

<h3 id="iniciar-flujo-de-inicio-de-sesin-con-google">Iniciar Flujo de Inicio de Sesión con Google</h3>

<p>Para iniciar el flujo de inicio de sesión con Google, necesitamos agregarle un onClickListener a nuestro botón SignInButton.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">botonIniciarSesion</span> <span class="o">=</span> <span class="o">(</span><span class="n">SignInButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">boton_sesion_google</span><span class="o">);</span>
<span class="n">botonIniciarSesion</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">iniciarSesionConGoogle</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<p>Al hacer clic en el botón, necesitamos lanzar un Intent el cual se crea utilizando el objeto <em>GoogleApiClient</em> que acabamos de configurar.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="n">Auth</span><span class="o">.</span><span class="na">GoogleSignInApi</span><span class="o">.</span><span class="na">getSignInIntent</span><span class="o">(</span><span class="n">clienteApiGoogle</span><span class="o">);</span>
</code></pre>
</div>

<p>Iniciaremos una actividad por resultado, pasando el intent y un código de solicitud (en nuestro caso es CS_INICIAR_SESION = 9001).</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">CS_INICIAR_SESION</span><span class="o">);</span>
</code></pre>
</div>

<p>Lo que hace el <em>startActivityForResult()</em> es iniciar la actividad de inicio de sesión de Google y regresar un resultado a nuestra actividad. Este resultado lo tenemos que obtener en el método <em>onActivityResult()</em>.</p>

<p>Primero debemos de comprobar que el codigo de solicitud recibido sea el mismo que el que enviamos. Posteriormente, en el Intent datos que recibimos viene la información de la cuenta seleccionada del usuario. Debemos de obtener un <em>GoogleSignInResult</em> utilizando este Intent. Podemos utilizarlo también para ver si el inicio de sesión fue exitoso. Si fue exitoso, de este objeto podemos obtener la cuenta del usuario, con el objeto <em>GoogleSignInAccount</em>. Por último, utilizando este objeto, debemos de iniciar sesión en Firebase.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">codigoSolicitud</span><span class="o">,</span> <span class="kt">int</span> <span class="n">codigoResultado</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">datos</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">codigoSolicitud</span><span class="o">,</span> <span class="n">codigoResultado</span><span class="o">,</span> <span class="n">datos</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">codigoSolicitud</span> <span class="o">==</span> <span class="n">CS_INICIAR_SESION</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">GoogleSignInResult</span> <span class="n">resultado</span> <span class="o">=</span> <span class="n">Auth</span><span class="o">.</span><span class="na">GoogleSignInApi</span><span class="o">.</span><span class="na">getSignInResultFromIntent</span><span class="o">(</span><span class="n">datos</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">resultado</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">GoogleSignInAccount</span> <span class="n">cuenta</span> <span class="o">=</span> <span class="n">resultado</span><span class="o">.</span><span class="na">getSignInAccount</span><span class="o">();</span>
            <span class="n">inicioSesionFirebaseConCuentaGoogle</span><span class="o">(</span><span class="n">cuenta</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// Hubo un error</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="iniciando-sesin-en-firebase-con-una-cuenta-google">Iniciando sesión en Firebase con una cuenta Google</h3>

<p>Utilizando un <em>Id Token</em> que tiene nuestro objeto <em>GoogleSignInAccount</em> obtenido previamente, necesitamos obtener una credencial de tipo <em>AuthCredential</em>. Esta credencial se obtiene utilizando el objeto de Firebase <em>GoogleAuthProvider</em>. Esta credencial se utilizará para iniciar sesión.</p>

<p>Por último, llamareoms el método <em>signInWithCredential()</em> de nuestro objeto FirebaseAuth, pasándole la credencial obtenida. De igual manera se le agrega un <em>OnCompleteListener</em>, con el cual podemos ver si hubo un error al iniciar sesión con Firebase. Cuando se termine de ejecutar este método, se manda llamar el método <em>onAuthStateChanged()</em> de nuestro  FirebaseAuth.AuthStateListener, con el cual podemos obtener la información del usuario.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">inicioSesionFirebaseConCuentaGoogle</span><span class="o">(</span><span class="n">GoogleSignInAccount</span> <span class="n">cuentaGoogle</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">AuthCredential</span> <span class="n">credencial</span> <span class="o">=</span> <span class="n">GoogleAuthProvider</span><span class="o">.</span><span class="na">getCredential</span><span class="o">(</span><span class="n">cuentaGoogle</span><span class="o">.</span><span class="na">getIdToken</span><span class="o">(),</span> <span class="kc">null</span><span class="o">);</span>
    <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">signInWithCredential</span><span class="o">(</span><span class="n">credencial</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addOnCompleteListener</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="n">OnCompleteListener</span><span class="o">&lt;</span><span class="n">AuthResult</span><span class="o">&gt;()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onComplete</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">Task</span><span class="o">&lt;</span><span class="n">AuthResult</span><span class="o">&gt;</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>

                    <span class="k">if</span> <span class="o">(!</span><span class="n">task</span><span class="o">.</span><span class="na">isSuccessful</span><span class="o">())</span> <span class="o">{</span>
                        <span class="c1">// Hubo un error</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">});</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Al terminar de agregar este código, podremos ser capaces de iniciar sesión con Google Sign-In. <strong>IMPORTANTE: recuerden agregar su ID al objeto GoogleSignInOptions y de activar la opción de iniciar sesión con Google Sign-In en la consola.</strong></p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/16.google-signin-button.png"><img src="https://warriorminds.github.io//images/fb/auth/16.google-signin-button.png" alt="Actividad para iniciar sesión con cuenta de Google" /></a>
</figure>

<p>Al iniciar el flujo de inicio de sesión, se nos presenta un diálogo para elegir una cuenta:</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/17.choose-google-account.png"><img src="https://warriorminds.github.io//images/fb/auth/17.choose-google-account.png" alt="Elegir una cuenta Google para iniciar sesión." /></a>
</figure>

<p>La primera vez que inicies sesión con Google, tendrás que dar permiso a la app para utilizar tu información.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/18.google-sigin-permissions.png"><img src="https://warriorminds.github.io//images/fb/auth/18.google-sigin-permissions.png" alt="Permisos para iniciar sesión." /></a>
</figure>

<p>Al concluir este proceso, hemos iniciado sesión con Google.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/19.google-signin-completed.png"><img src="https://warriorminds.github.io//images/fb/auth/19.google-signin-completed.png" alt="Inicio de sesión con Google completado." /></a>
</figure>

<h2 id="inicio-de-sesin-con-facebook">Inicio de Sesión con Facebook</h2>

<p>Ahora aprenderemos como utilizar Facebook para iniciar sesión con Firebase.</p>

<h3 id="creando-tu-app-en-facebook">Creando tu App en Facebook</h3>

<p>Lo primero que tenemos que hacer es crear nuestra aplicación en Facebook. Hay que entrar a la página de <a href="https://developers.facebook.com/apps/" target="_blank">Facebook Developers</a>. En esta página podrán ver todas las aplicaciones que tengan actualmente así como agregar nuevas apps.</p>

<p>Para agregar una nueva aplicación, hay que dar clic en el botón <em>Agregar una nueva app</em>.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/20.fb-dev-console.png"><img src="https://warriorminds.github.io//images/fb/auth/20.fb-dev-console.png" alt="Facebook developers." /></a>
</figure>

<p>Nos pedirán algunos datos de nuestra aplicación: nombre de la app y algún correo electrónico para contacto, así como la categoría a la que pertenece nuestra app. Al llenar estos campos, dar clic en el botón para crear el ID de tu app.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/21.fb-create-app.png"><img src="https://warriorminds.github.io//images/fb/auth/21.fb-create-app.png" alt="Crear app en Facebook." /></a>
</figure>

<p>Una vez creada nuestra app, entramos a la consola donde la podemos administrar. Necesitamos obtener un par de valores de nuestra app de Facebook. Para esto, hay que ir a <em>Configuración -&gt; Básica</em>. Ahí podemos ver el <em>Identificador de la aplicación</em> y podemos mostrar la <em>Clave secreta de la aplicación</em>. Necesitamos guardar estos dos valores para utilizarlos en Firebase posteriormente.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/22.fb-secret-id.png"><img src="https://warriorminds.github.io//images/fb/auth/22.fb-secret-id.png" alt="Valores de Id de la aplicación y clave secreta de la aplicación." /></a>
</figure>

<p>Ahora debemos agregar una plataforma, que en nuestro caso será Android. Esto lo pueden hacer en la parte inferior de la misma pantalla, en <em>Configuración -&gt; Básica</em>.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/25.fb-add-androidapp.png"><img src="https://warriorminds.github.io//images/fb/auth/25.fb-add-androidapp.png" alt="Agregar la plataforma Android." /></a>
</figure>

<p>Una vez agregada la plataforma Android, nos piden algunos datos. Debemos agregar el paquete de nuestra app y el nombre de la clase que hará el inicio de sesión con Facebook.</p>

<p>De igual manera nos piden los hashes de clave de nuestra app.</p>

<h4 id="obteniendo-los-hashes-de-clave">Obteniendo los Hashes de clave</h4>

<p>Para obtener los Hashes de clave de nuestra app necesitamos utilizar <em>OpenSSL</em>. En Windows pueden descargar OpenSSL <a href="https://code.google.com/archive/p/openssl-for-windows/downloads" target="_blank">aquí</a>. Hay que extraer su contenido y después debemos de crear una carpeta en <em>C:/</em>, en mi caso cree una carpeta llamada c:/openssl, en donde debemos de pegar todo el contenido del archivo que extrajimos previamente.</p>

<p>Necesitamos saber la ubicación de nuestro archivo keystore (esto aplica tanto para su keystore de desarrollo como para el de producción, en caso de que lo tengan.). La ubicación para el keystore de desarrollo en Windows es <em>%USERPROFILE%.android\debug.keystore</em></p>

<p>Debemos ir a la ubicación del programa <em>keytool.exe</em> la cual es <em>c:/Program Files/Java/jdk1.8.0_92/bin</em></p>

<p>Una vez ahí, ejecutaremos la siguiente instrucción</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">keytool</span> <span class="o">-</span><span class="n">exportcert</span> <span class="o">-</span><span class="n">alias</span> <span class="n">androiddebugkey</span> <span class="o">-</span><span class="n">keystore</span>  <span class="o">%</span><span class="n">USERPROFILE</span><span class="o">%</span><span class="err">\</span><span class="o">.</span><span class="na">android</span><span class="err">\</span><span class="n">debug</span><span class="o">.</span><span class="na">keystore</span> <span class="o">|</span> <span class="s">"C:\openssl\bin\openssl"</span> <span class="n">sha1</span> <span class="o">-</span><span class="n">binary</span> <span class="o">|</span><span class="s">"C:\openssl\bin\openssl"</span> <span class="n">base64</span>
</code></pre>
</div>

<p>Les pedirá el password de su keystore el cual es “android” si utilizan el de desarrollo. Con esto obtendrán el hash y lo deberán de ingresar en la consola de Facebook.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/26.android-app-fb.png"><img src="https://warriorminds.github.io//images/fb/auth/26.android-app-fb.png" alt="Agregar hashes de clave." /></a>
</figure>

<h3 id="habilitar-inicio-de-sesin-con-facebook-en-firebase">Habilitar Inicio de Sesión con Facebook en Firebase</h3>

<p>Es momento de regresar a la <a href="https://console.firebase.google.com/" target="_blank">consola de Firebase</a>. En el menú de la izquierda hay que ir a Autenticación, y seleccionar la pestaña de <em>Método de Inicio de Sesión</em>. Hay que habilitar la opción de Facebook. Esto nos abrirá un diálogo en donde tenemos que ingresar nuestra <em>ID de aplicación</em> y la <em>Clave secreta</em> que obtuvimos en la consola de Facebook.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/23.fb-enable-firebase.png"><img src="https://warriorminds.github.io//images/fb/auth/23.fb-enable-firebase.png" alt="Agregar ID de aplicación y clave secreta." /></a>
</figure>

<p>En la parte inferior de este diálogo hay una URL de la forma <em>my-app-12345.firebaseapp.com/__/auth/handler</em>. Esta URL hay que copiarla y agregarla en la consola de Facebook.</p>

<p>Una vez en la consola de Facebook hay que ir en el menú de la izquierda a <em>Inicio de Sesión con Facebook</em>. Hay un campo llamado <em>URI de redireccionamiento de OAuth válidos</em>. En este campo hay que pegar la URL que obtuvimos en Firebase.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/24.fb-oaut-redirect-url.png"><img src="https://warriorminds.github.io//images/fb/auth/24.fb-oaut-redirect-url.png" alt="URL de redireccionamiento de OAuth." /></a>
</figure>

<h3 id="agregar-el-sdk-de-facebook">Agregar el SDK de Facebook</h3>

<p>Después de terminar con la configuración de nuestra app en Facebook y en Firebase, llegó el momento de agregar el SDK de Facebook a nuestra app. Para empezar, en el <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/build.gradle" target="_blank">build.gradle</a> del proyecto, agregar en repositories <em>mavenCentral()</em>. Esto nos permitirá descargar la dependencia de Facebook.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">repositories</span> <span class="o">{</span>
    <span class="n">jcenter</span><span class="o">()</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Ahora debemos de agregar la dependencia en el <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/app/build.gradle" target="_blank">build.gradle</a> de la app:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">compile</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">facebook</span><span class="o">.</span><span class="na">android</span><span class="o">:</span><span class="n">facebook</span><span class="o">-</span><span class="n">android</span><span class="o">-</span><span class="nl">sdk:</span><span class="mf">4.17</span><span class="o">.</span><span class="mi">0</span><span class="err">'</span>
</code></pre>
</div>

<p>Facebook necesita saber el <em>ID de nuestra aplicación</em> que obtuvimos previamente en la consola de Facebook. Debemos agregar un atributo metadata en el manifest de nuestra app. Debe tener como nombre <em>com.facebook.sdk.ApplicationId y como valor un string con el *ID de nuestra aplicación</em>.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">meta</span><span class="o">-</span><span class="n">data</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">"com.facebook.sdk.ApplicationId"</span> <span class="nl">android:</span><span class="n">value</span><span class="o">=</span><span class="s">"@string/facebook_app_id"</span><span class="o">/&gt;</span>
</code></pre>
</div>

<p>Con esto, estamos listos para agregar el código para iniciar sesión. Necesitamos agregar el botón de inicio de sesión de Facebook. En nuestro layout, <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/app/src/main/res/layout/activity_iniciar_sesion_facebook.xml" target="_blank">activity_iniciar_sesion_facebook.xml</a>, vamos a agregar este botón.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">com</span><span class="o">.</span><span class="na">facebook</span><span class="o">.</span><span class="na">login</span><span class="o">.</span><span class="na">widget</span><span class="o">.</span><span class="na">LoginButton</span>
    <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">"@+id/login_button"</span>
    <span class="nl">android:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">"wrap_content"</span>
    <span class="nl">android:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">"wrap_content"</span>
    <span class="nl">android:</span><span class="n">layout_gravity</span><span class="o">=</span><span class="s">"center_horizontal"</span>
    <span class="nl">android:</span><span class="n">layout_marginTop</span><span class="o">=</span><span class="s">"30dp"</span>
    <span class="nl">android:</span><span class="n">layout_marginBottom</span><span class="o">=</span><span class="s">"30dp"</span> <span class="o">/&gt;</span>
</code></pre>
</div>

<p>El código para iniciar sesión con Facebook lo pueden encontrar en <a href="https://github.com/warriorminds/firebase-autenticacion/blob/master/app/src/main/java/com/warriorminds/firebase/IniciarSesionFacebookActivity.java" target="_blank">IniciarSesionFacebookActivity.java</a></p>

<p>En la actividad debemos de inicializar el SDK de Facebook <strong>ANTES</strong> de llamar el <em>setContentView()</em> con nuestro layout.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">FacebookSdk</span><span class="o">.</span><span class="na">sdkInitialize</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">());</span>
</code></pre>
</div>

<p>También debemos de crear un <em>CallbackManager</em> que es el objeto de Facebook que maneja las llamadas desde la actividad o fragment.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">manejadorDeLlamadas</span> <span class="o">=</span> <span class="n">CallbackManager</span><span class="o">.</span><span class="na">Factory</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
</code></pre>
</div>

<p>Facebook requiere que le agreguemos al <em>LoginButton</em> los permisos que necesitamos pedirle al usuario. Firebase nos pide que al menos pidamos los permisos de <em>email</em> y <em>public_profile</em>. Igualmente se deben de registrar una llamada de regreso (callback) para manejar los cambios de sesión de Facebook. Este callback nos permitirá manejar los casos en que el inicio de sesión sea exitoso, cuando el usuario cancele el inicio de sesión o cuando se presente algún error al iniciar sesión. Cuando iniciemos con éxito la sesión con Facebook, debemos iniciar sesión con Firebase, utilizando el <em>accessToken</em> que nos provee Facebook mediante el <em>LoginResult</em>:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">FacebookSdk</span><span class="o">.</span><span class="na">sdkInitialize</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">());</span>
<span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_iniciar_sesion_facebook</span><span class="o">);</span>

<span class="n">manejadorDeLlamadas</span> <span class="o">=</span> <span class="n">CallbackManager</span><span class="o">.</span><span class="na">Factory</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>

<span class="n">LoginButton</span> <span class="n">botonLogin</span> <span class="o">=</span> <span class="o">(</span><span class="n">LoginButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">boton_login_facebook</span><span class="o">);</span>
<span class="n">botonLogin</span><span class="o">.</span><span class="na">setReadPermissions</span><span class="o">(</span><span class="s">"email"</span><span class="o">,</span> <span class="s">"public_profile"</span><span class="o">);</span>
<span class="n">botonLogin</span><span class="o">.</span><span class="na">registerCallback</span><span class="o">(</span><span class="n">manejadorDeLlamadas</span><span class="o">,</span> <span class="k">new</span> <span class="n">FacebookCallback</span><span class="o">&lt;</span><span class="n">LoginResult</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSuccess</span><span class="o">(</span><span class="n">LoginResult</span> <span class="n">loginResult</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">iniciarSesionFirebaseConFacebook</span><span class="o">(</span><span class="n">loginResult</span><span class="o">.</span><span class="na">getAccessToken</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCancel</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">IniciarSesionFacebookActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">"Usuario canceló inicio de sesión con Facebook."</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="n">FacebookException</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">IniciarSesionFacebookActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">"Hubo un error al iniciar sesión con Facebook."</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
</div>

<p>Para terminar con el código de Facebook para iniciar sesión, se debe de agregar el método <em>onActivityResult()</em> donde se llame al método <em>onActivityResult()</em> del manejador de llamadas de Facebook:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="n">manejadorDeLlamadas</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="inicializando-firebase">Inicializando Firebase</h3>

<p>Este paso es idéntico a lo realizado previamente para iniciar sesión con Google y con correo electrónico. Hay que obtener la instancia de FirebaseAuth, crear el listener y agregar y quitar el listener en el onStart() y en el onStop(). Recuerden que el método <em>onAuthStateChanged()</em> del FirebaseAuth.AuthStateListener es el que se manda llamar cuando se detecta algún cambio de sesión con Firebase:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">inicializarAutenticacion</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">autenticacionFirebase</span> <span class="o">=</span> <span class="n">FirebaseAuth</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>

    <span class="n">listenerAutenticacion</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FirebaseAuth</span><span class="o">.</span><span class="na">AuthStateListener</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAuthStateChanged</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">FirebaseAuth</span> <span class="n">firebaseAuth</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">FirebaseUser</span> <span class="n">usuario</span> <span class="o">=</span> <span class="n">firebaseAuth</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">usuario</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
    <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">addAuthStateListener</span><span class="o">(</span><span class="n">listenerAutenticacion</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">listenerAutenticacion</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">removeAuthStateListener</span><span class="o">(</span><span class="n">listenerAutenticacion</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Por último, necesitamos iniciar sesión con Firebase utilizando el <em>AccessToken</em> que obtuvimos de Facebook. Se crea una credencial con el token de acceso y se manda llamar el método <em>signInWithCredential()</em> del objeto FirebaseAuth utilizando la credencial creada.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">iniciarSesionFirebaseConFacebook</span><span class="o">(</span><span class="n">AccessToken</span> <span class="n">tokenDeAcceso</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">AuthCredential</span> <span class="n">credencial</span> <span class="o">=</span> <span class="n">FacebookAuthProvider</span><span class="o">.</span><span class="na">getCredential</span><span class="o">(</span><span class="n">tokenDeAcceso</span><span class="o">.</span><span class="na">getToken</span><span class="o">());</span>
    <span class="n">autenticacionFirebase</span><span class="o">.</span><span class="na">signInWithCredential</span><span class="o">(</span><span class="n">credencial</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addOnCompleteListener</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="n">OnCompleteListener</span><span class="o">&lt;</span><span class="n">AuthResult</span><span class="o">&gt;()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onComplete</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">Task</span><span class="o">&lt;</span><span class="n">AuthResult</span><span class="o">&gt;</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>

                    <span class="k">if</span> <span class="o">(!</span><span class="n">task</span><span class="o">.</span><span class="na">isSuccessful</span><span class="o">())</span> <span class="o">{</span>
                        <span class="c1">// Hubo un error al iniciar sesión con Firebase</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">});</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Después de este paso, podemos hacer login con nuestra cuenta de Facebook.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/27.fb-login.png"><img src="https://warriorminds.github.io//images/fb/auth/27.fb-login.png" alt="Iniciar sesión con Facebook." /></a>
</figure>

<p>La primera vez, nos indicará los permisos que va a utilizar la app.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/28.fb-permissions.png"><img src="https://warriorminds.github.io//images/fb/auth/28.fb-permissions.png" alt="Permisos para iniciar sesión con Facebook." /></a>
</figure>

<p>Al aceptar los permisos y continuar, logramos iniciar sesión.</p>

<figure>
	<a href="https://warriorminds.github.io//images/fb/auth/29.fb-firebase-login.png"><img src="https://warriorminds.github.io//images/fb/auth/29.fb-firebase-login.png" alt="Inicio de sesión con Facebook." /></a>
</figure>

<h3 id="cerrar-sesin-con-facebook-y-firebase">Cerrar sesión con Facebook y Firebase</h3>

<p>Facebook nos proporciona el botón de Logout o Cerrar Sesión. También nos proporciona un objeto <em>AccessTokenTracker</em> el cual tiene un listener con el método <em>onCurrentAccessTokenChanged()</em> el cual se manda llamar cada vez que el token de Facebook cambia, lo cual ocurre al iniciar o cerrar sesión. Cuando se cierra sesión en Facebook, este valor viene nulo y podemos cerrar sesión también con Firebase.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">AccessTokenTracker</span> <span class="n">accessTokenTracker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AccessTokenTracker</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCurrentAccessTokenChanged</span><span class="o">(</span>
            <span class="n">AccessToken</span> <span class="n">oldAccessToken</span><span class="o">,</span>
            <span class="n">AccessToken</span> <span class="n">currentAccessToken</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">currentAccessToken</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="n">cerrarSesionFirebase</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">};</span>
</code></pre>
</div>

<h2 id="conclusin">Conclusión</h2>

<p>En esta primera parte, aprendimos cómo utilizar Firebase para iniciar sesión utilizando correo y contraseña, una cuenta de Google y una cuenta de Facebook. Como pudimos ver, el código de Firebase para los tres escenarios es prácticamente el mismo: obtener la instancia de FirebaseAuth, crear un listener de tipo FirebaseAuth.AuthStateListener, agregar y quitar el listener en el onStart() y onStop().</p>

<p>Para iniciar sesión con cualquiera de los tres proveedores, el objeto FirebaseAuth nos proporcina los métodos necesarios.</p>

<ul>
  <li>createUserWithEmailAndPassword(): para crear una cuenta con correo y contraseña.</li>
  <li>signInWithEmailAndPassword(): para iniciar sesión con correo y contraseña.</li>
  <li>signInWithCredential(): para iniciar sesión con Google o Facebook.</li>
</ul>

<p>También Firebase nos provee dos Providers, para crear una credencial y poder iniciar sesión:</p>

<ul>
  <li>GoogleAuthProvider.getCredential(): para crear la credencial utilizando el TokenId obtenido de iniciar sesión con Google.</li>
  <li>FacebookAuthProvider.getCredential(): para crear la credencial utilizando el AccessToken obtenido al iniciar sesión con Facebook.</li>
</ul>

<p>Antes de poder iniciar sesión con Firebase, es necesario configurar los objetos de Google, al utilizar Google para iniciar sesión, así como crear y configurar tu app en Facebook y configurar el SDK en tu código, al utilizar Facebook para iniciar sesión, como se mostró en este post.</p>

<p>En la segunda parte de autenticación con Firebase, aprenderemos a iniciar sesión con Twitter y Github, así como tener usuarios anónimos y la manera en que podemos combinar varios proveedores para iniciar sesión con una misma cuenta.</p>


        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'warriormindswebsite'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="https://warriorminds.github.io//blogesp/firebase-intro/" class="btn" title="Introducción a Firebase">Anterior</a>
      
      
        <a href="https://warriorminds.github.io//blogesp/firebase-auth-part2/" class="btn" title="Autenticación con Firebase - Segunda Parte: Twitter, Usuarios Anónimos y Diferentes Proveedores en una misma Cuenta">Siguiente</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    <div class="google-ads" style="margin:10px 0;">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- 320x50 ad -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:320px;height:50px"
       data-ad-client="ca-pub-8872211495609343"
       data-ad-slot="9595923317"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div><!-- /.google-ads -->

<span>&copy; 2018 Warrior Minds. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/warrior_minds" title="Warrior Minds on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://facebook.com/warriorminds" title="Warrior Minds on Facebook" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a>
	<a href="https://plus.google.com/102230749926196780961" title="Warrior Minds on Google+" target="_blank"><i class="fa fa-google-plus-square fa-2x"></i></a>
	
	
	
	
	<a href="https://github.com/warriorminds" title="Warrior Minds on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
	<a href="https://www.youtube.com/channel/UCHGyNJUbgk39Q4UhlVX6ucA" title="Warrior Minds on Youtube" target="_blank"><i class="fa fa-youtube-square fa-2x"></i></a>
  <a href="https://warriorminds.github.io//feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'https://warriorminds.github.io/';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://warriorminds.github.io//assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://warriorminds.github.io//assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 'https://www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-86871758-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



</body>
</html>
